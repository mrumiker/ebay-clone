{% extends "auctions/layout.html" %}

{% block body %}
<h2>Album Details</h2>
{% if messages %}
<div class="alert alert-warning" role="alert">
  {% for message in messages %}
  {{ message }}
  {% endfor %}
</div>
{% endif %}
<div class="card" style="width: 26rem;">
  <div class="card-header"><a href="{% url 'index' %}">‚¨ÖÔ∏è</a></div>
  <img src="{{ album.image_url }}" class="card-img-top" alt="cover of {{ album }}">
  <div class="card-body" style="background-color: linen;">
    <h4 class="card-title">{{ album.title }}</h4>
    <h5 class="card-subtitle mb-2">{{ album.artist }}</h5>
    <h6 class="card-text">{{ album.year }}</h6>
    <p class="card-text">{{ album.description }}</p>
  </div>

  <ul class="list-group list-group-flush">
    <li class="list-group-item" style="background-color: floralwhite;">
      <h6 class="mb-0">Genres</h6>
    </li>
    {% for genre in genres %}
    <li class="list-group-item list-group-flush px-5" style="background-color: floralwhite;">
      {{ genre }}
    </li>
    {% endfor %}
  </ul>
  <div class="card-body" style="background-color: oldlace;"></div>
  <ul class="list-group list-group-flush">
    {% if album.datetime_closed %}
    {% if max_bidder == album.seller %}
    {% if user == album.seller %}
    <li class="list-group-item" style="background-color: oldlace;">
      Listing withdrawn by you on {{ album.datetime_closed }}
    </li>
    {% else %}
    <li class="list-group-item" style="background-color: oldlace;">
      Listing withdrawn by {{ album.seller }} on {{ album.datetime_closed }}
    </li>
    {% endif %}
    {% elif max_bidder == user %}
    <li class="list-group-item" style="background-color: oldlace;">
      <b>SOLD TO YOU</b> on {{ album.datetime_closed }} for ${{ max_bid }}!
    </li>
    {% else %}
    <li class="list-group-item" style="background-color: oldlace;">
      <b>SOLD</b> to {{ max_bidder }} on {{ album.datetime_closed }} for ${{ max_bid }}
    </li>
    {% endif %}
    {% elif user.id == max_bidder.id %}
    <li class="list-group-item" style="background-color: oldlace;">
      Current bid is <b>${{ max_bid }}</b> by you
    </li>
    {% else %}
    <li class="list-group-item" style="background-color: oldlace;">
      Current bid is <b>${{ max_bid }}</b> by {{ max_bidder }}
    </li>
    {% endif %}
    {% if user.id == album.seller.id %}
    <li class="list-group-item text-muted" style="background-color: oldlace;">Offered by you on
      {{ album.datetime_created }}
    </li>
    {% else %}
    <li class="list-group-item text-muted" style="background-color: oldlace;">
      Offered by {{ album.seller }} on {{ album.datetime_created }}
    </li>
    {% endif %}
  </ul>
  {% if user.is_authenticated %}
  <div class="card-body text-center">
    {% if album.datetime_closed %}
    <button type="button" class="btn btn-secondary w-100" disabled>NOT FOR SALE</button>
    {% elif user.id == album.seller.id %}
    <form action="{% url 'close' %}" method="post">
      {% csrf_token %}
      <input type="hidden" name="album" value="{{ album.id }}">
      <input type="submit" class="btn btn-danger w-100" value="CLOSE THIS LISTING">
    </form>
    {% else %}
    <form action="{% url 'bid' %}" method="post">
      {% csrf_token %}
      <div class="form-row align-items-center justify-content-center">
        <div class="col-auto">
          üí≤<input type="number" name="amount_0" min="{{ max_bid }}" step="0.01" required id="id_amount_0"
            placeholder="Enter a Bid">
          <input type="hidden" name="amount_1" value="USD" id="id_amount_1">
          <input type="hidden" name="album" value="{{ album.id }}">
          <input type="hidden" name="bidder" value="{{ user.id }}">
        </div>
        <div class="col-auto">
          <input class="btn btn-primary w-100 px-4" type="submit" value="BID">
        </div>
      </div>
    </form>
    {% endif %}
  </div>
  {% endif %}
  <div class="card-footer">
    <a href="{% url 'index' %}" class="card-link">Go Back</a>
    {% if user.is_authenticated %}
    {% if user in watchers %}
    <a href="{% url 'delete_from_watchlist' user.id album.id %}" class="card-link">Remove from Watchlist</a>
    {% else %}
    <a href="{% url 'add_to_watchlist' user.id album.id %}" class="card-link">Add to Watchlist</a>
    {% endif %}
    {% endif %}
  </div>
</div>
<div id="comments-container">
  <h5>Comments</h5>
  <ul>
    {% for comment in comments %}
    <li>{{ comment }}</li>
    {% endfor %}
  </ul>
</div>
{% if user.is_authenticated %}
<div id="comment-form-container">
  <form action="{% url 'comment' %}" method="post">
    {% csrf_token %}
    <input type="hidden" name="album" value="{{ album.id }}">
    <input type="hidden" name="commenter" value="{{ user.id }}">
    <!-- {{ comment_form }} -->
    <label for="comment-text">Comment</label>
    <textarea name="text" id="id_text" cols="49" rows="10" maxlength="1024" required
      placeholder="Type your comment on this listing here"></textarea>
    <input type="submit" value="Post Comment">
  </form>
</div>
{% endif %}

{% endblock %}